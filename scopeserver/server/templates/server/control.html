{% extends "server/base.html" %} {% block head %}
<style>
button.slewbutton {
    margin: 15px 15px 15px 15px;
}
button.guidebutton {
    margin: 15px 15px 15px 15px;
}
button.actionbutton {
    margin: 0px 0px 0px 0px;
}
</style>
<style type="text/css">
  .dark-background {background-color:#202020;}
  .red {color:#d00000;}
</style>
{% endblock %} {% block body %} {% csrf_token %}
<!--  Status Display  -->
<!-- <div class="well well-sm"> -->
<div>
    <table id="scopeinfo" border=1 bordercolor="#ff0000">
        <tr>
            <th class="serverlabel">GPS Loc:</th>
            <th class="displayvalue" id="gps_location_lat"></th>
            <th class="displayvalue" id="gps_location_lon"></th>
        </tr>
        <tr>
            <th class="serverlabel">Local Time</th>
            <th class="displayvalue" id="local_time"></th>
            <tr>
                <th class="serverlabel">UTC Time</th>
                <th class="displayvalue" id="utc_time"></th>
            </tr>
            <tr>
                <th class="serverlabel">Scope Pos:</th>
                <th class="displayvalue" id="scope_position_dec"></th>
                <th class="displayvalue" id="scope_position_ra"></th>
            </tr>
            <tr>
                <th class="serverlabel">GOTO Target:</th>
                <th class="displayvalue" id="target_position_dec"></th>
                <th class="displayvalue" id="target_position_ra"></th>
            </tr>
            <tr>
                <th class="serverlabel">Motor Current:</th>
                <th class="displayvalue" id="motor_current_dec"></th>
                <th class="displayvalue" id="motor_current_ra"></th>
            </tr>
            <tr>
                <th class="serverlabel">Pos Error:</th>
                <th class="displayvalue" id="pos_error_dec"></th>
                <th class="displayvalue" id="pos_error_ra"></th>
            </tr>
    </table>
</div>
<!--  Scope Slew Controls  -->
<div align="center">
    <button class="btn btn-primary dark-background red slewbutton" name="slew_north" value="north">
        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
    </button>
</div>
<div align="center">
    <button class="btn btn-primary dark-background red slewbutton" name="slew_west" value="west">
        <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    </button>
    <button class="btn btn-primary dark-background red guidebutton" name="slew_guide" value="guide">
        <span class="glyphicon glyphicon-record" aria-hidden="true"></span>
    </button>
    <button class="btn btn-primary dark-background red slewbutton" name="slew_east" value="east">
        <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
    </button>
</div>
<div align="center">
    <button class="btn btn-primary dark-background red slewbutton" name="slew_south" value="south">
        <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
    </button>
</div>

<!--  Display ScopeServer Error Message  -->
<div align="center" style="color:red" id="errorDiv"></div>

<!--  Raspberry Pi Reboot/Shutdown Controls  -->
<div class="fixed">
    <object align="left">
        <button class="btn btn-primary dark-background red actionbutton" name="reboot" value="reboot">Reboot &raquo;</button>
    </object>
    <object align="center">
        <button class="btn btn-primary dark-background red actionbutton" name="reset" value="reset">Reset &raquo;</button>
    </object>
    <object align="right">
        <button class="btn btn-warning dark-background red actionbutton" name="shutdown" value="shutdown">Shutdown &raquo;</button>
    </object>
</div>

<!--  Script to Update Status Display  -->
<script>
function get_scope_status() {
    jQuery.ajax({
        data: {
            csrfmiddlewaretoken: csrftoken,
            action: "serverStatus",
        },
        type: 'POST',
        success: function(result) {
            if (result['status'] == "Success") {
                for (var key in result) {
                    if (key != "status") {
                        var value = result[key];
                        $(key).html(value);
                    }
                }
                $("#errorDiv").html("");
            } else {
                console.log(result);
                window.location.reload();
            }
        },
        error: function(jqXHR, textStatus, String) {
            $("#errorDiv").html("Error Contacting ScopeServer");
        },
    });
}
</script>

<!--  Slew Control Script   -->
<script>
    function slewSend(e){
        jQuery.ajax({
            data: {
                csrfmiddlewaretoken: csrftoken,
                slew: e.currentTarget.name,
                mouse: e.type,
            },
            type: 'POST',
            success: function(result) {
                if (result['status'] == "Success") {
                    for (var key in result) {
                        if (key != "status") {
                            var value = result[key];
                            $(key).html(value);
                        }
                    }
                } else {
                    alert(result['msg']);
                    window.location.reload();
                }
            },
            error: function(jqXHR, textStatus, String) {
                $("#errorDiv").html("Error Contacting ScopeServer");
            },
        });
    }
    $(".slewbutton").on('touchstart',function(e){e.preventDefault(); slewSend(e);});
    $(".slewbutton").on('click',function(e){slewSend(e);});
    $(".slewbutton").on('touchend',function(e){e.preventDefault(); slewSend(e);});
    $(".guidebutton").click(function(e){slewSend(e);});
</script>

<script>
    function actionSend(e){
        jQuery.ajax({
            data: {
                csrfmiddlewaretoken: csrftoken,
                action: e.currentTarget.name,
            },
            type: 'POST',
            success: function(result) {
                if (result['status'] == "Success") {
                    for (var key in result) {
                        if (key != "status") {
                            var value = result[key];
                            $(key).html(value);
                        }
                    }
                } else {
                    alert(result['msg']);
                    window.location.reload();
                }
            },
            error: function(jqXHR, textStatus, String) {
                $("#errorDiv").html("Error Contacting ScopeServer");
            },
        });
    }
    $(".actionbutton").click(function(e){
        actionSend(e);
    });
</script>

<script>
  var interval_scope_status = setInterval(get_scope_status, 200);
</script>
{% endblock %}
